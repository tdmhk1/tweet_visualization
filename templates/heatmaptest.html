<!DOCTYPE html>
<html lang="ja">
  <head>
    <meta charset="utf-8">
    <mate http-equiv="Content-style-Type" content="text/css" />
    <title>ホットスポットナビ</title>
    <!-- スタイルシートの適用 -->
    <link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='mapstyle.css') }}" />
    <!-- googlemapの利用 -->
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp&libraries=visualization&language=ja"></script>
    <!-- Javascriptファイルの読み込み -->
    <script type="text/javascript" src="{{ url_for('static', filename='heatmap.js') }}"></script>
    <script>
      // 変数宣言
      var map, pointarray, heatmap;
      // データの作成
      var taxiData = [
        new google.maps.LatLng({{count_data[0][0]}}, {{count_data[0][1]}}),
        new google.maps.LatLng(37.782745, -122.444586),
        new google.maps.LatLng(37.782842, -122.443688),
        new google.maps.LatLng(37.782919, -122.442815),
        new google.maps.LatLng(37.782992, -122.442112)
      ];

      // ツイート数が最も多い地域
      var pointmax = [{{count_data[0][0]}}, {{count_data[0][1]}}]

      // 各ブロックの代表点は左下なので、これを修正するために
      // 緯度、経度それぞれに刻み幅の半分を足す
      var point_unit = [0.008984, 0.011040]

      var pointmax = [pointmax[0] + point_unit[0]/2, pointmax[1] + point_unit[1]/2]

      // マップの初期化
      function initialize() {
        var mapOptions = {
          zoom: 15,
          center: new google.maps.LatLng(pointmax[0], pointmax[1]),
          mapTypeId: google.maps.MapTypeId.ROADMAP
        };

        map = new google.maps.Map(document.getElementById('map-canvas'),
            mapOptions);

        var pointArray = new google.maps.MVCArray(taxiData);

        heatmap = new google.maps.visualization.HeatmapLayer({
          data: pointArray
        });
　　　
        // コンストラクタの作成?
        heatmap.setMap(map);
      }

      // ヒートマップの切り替え
      function toggleHeatmap() {
        heatmap.setMap(heatmap.getMap() ? null : map);
      }

      // マップの表示?
      google.maps.event.addDomListener(window, 'load', initialize);
    </script>
  </head>

  <body>
    <!-- 見出し -->
    <h1>ホットスポットナビ</h1>

    <!-- 直近のデータ集計時刻と最大ツイート数を表示 -->
    <div class="migiue">
      データ集計時刻 {{count_data[0][3]}}<br>
      10分間の最大ツイート数 {{count_data[0][2]}}<br>
      最大ツイートの場所 ({{count_data[0][1]}}, {{count_data[0][0]}})<br>
      <button onclick="toggleHeatmap()">ヒートマップの切り替え</button>
    </div>

    <!-- 線を引く -->
    <hr>

    <!-- マップ表示用エレメント -->
    <div id="map-canvas"></div>

  </body>
</html>